<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head-fragment :: head(${'Profile'})">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Profile Template</title>
    <link rel="stylesheet" href="../static/bootstrap-4.5.2-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/profile.css">
    <link href="../static/fontawesome-free-5.14.0-web/css/all.css" rel="stylesheet">
</head>
<body>
<nav th:replace="fragments/nav-fragment :: nav(${0}, ${session.user})">
    Index Nav Part
</nav>
<main class="container mt-5 pt-4" style="min-height: 85vh;">
    <div class="card">
        <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs" id="nav-tab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link" id="post-tab" data-toggle="tab" href="#post-pane" role="tab"
                       aria-controls="post-tab" aria-selected="false"><i class="far fa-question-circle"></i> Yours</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="liked-tab" data-toggle="tab" href="#liked-pane" role="tab"
                       aria-controls="liked-tab" aria-selected="false"><i class="far fa-heart"></i> Liked</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="notification-tab" data-toggle="tab" href="#notification-pane" role="tab"
                       aria-controls="notification-tab" aria-selected="false"><i class="far fa-check-circle"></i> Notifications <span
                            class="badge badge-warning badge-pill">50</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="personal-info-tab" data-toggle="tab" href="#personal-info-pane" role="tab"
                       aria-controls="personal-info-tab" aria-selected="false"><i class="far fa-address-card"></i> Personal Info</a>
                </li>
            </ul>
        </div>
        <div class="card-body">
            <div class="tab-content" id="nav-tabContent">
                <!--        posts pane-->
                <div class="tab-pane fade" id="post-pane" role="tabpanel" aria-labelledby="post-tab">
                    <!--ten posts per page-->
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <span class="h5 mr-3">Post Title</span>
                            <span class="text-muted font-weight-light mr-3">
                                Last Modifed: <span> 2020-10-04 10:12 </span>
                            </span>
                            <span>
                                <a class="mx-1 btn btn-outline-secondary btn-sm border-0" href="">edit</a>
                                <a class="mx-1 btn btn-outline-danger btn-sm border-0" href="">delete</a>
                            </span>
                            <div class="mt-1 text-muted font-weight-light">
                                <span> 99 </span> Views |
                                <span> 99 </span> Replies |
                                <span> 99 </span> likes |
                                Created: <span> 2020-10-04 10:12 </span>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <span class="h5 mr-3">Post Title</span>
                            <span class="text-muted font-weight-light mr-3">
                                Last Modifed: <span> 2020-10-04 10:12 </span>
                            </span>
                            <span>
                                <a class="mx-1 btn btn-outline-secondary btn-sm border-0" href="">edit</a>
                                <a class="mx-1 btn btn-outline-danger btn-sm border-0" href="">delete</a>
                            </span>
                            <div class="mt-1 text-muted font-weight-light">
                                <span> 99 </span> Views |
                                <span> 99 </span> Replies |
                                <span> 99 </span> likes |
                                Created: <span> 2020-10-04 10:12 </span>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <span class="h5 mr-3">Post Title</span>
                            <span class="text-muted font-weight-light mr-3">
                                Last Modifed: <span> 2020-10-04 10:12 </span>
                            </span>
                            <span>
                                <a class="mx-1 btn btn-outline-secondary btn-sm border-0" href="">edit</a>
                                <a class="mx-1 btn btn-outline-danger btn-sm border-0" href="">delete</a>
                            </span>
                            <div class="mt-1 text-muted font-weight-light">
                                <span> 99 </span> Views |
                                <span> 99 </span> Replies |
                                <span> 99 </span> likes |
                                Created: <span> 2020-10-04 10:12 </span>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <span class="h5 mr-3">Post Title</span>
                            <span class="text-muted font-weight-light mr-3">
                                Last Modifed: <span> 2020-10-04 10:12 </span>
                            </span>
                            <span>
                                <a class="mx-1 btn btn-outline-secondary btn-sm border-0" href="">edit</a>
                                <a class="mx-1 btn btn-outline-danger btn-sm border-0" href="">delete</a>
                            </span>
                            <div class="mt-1 text-muted font-weight-light">
                                <span> 99 </span> Views |
                                <span> 99 </span> Replies |
                                <span> 99 </span> likes |
                                Created: <span> 2020-10-04 10:12 </span>
                            </div>
                        </li>
                    </ul>
                    <!--pagination-->
                    <nav class="mt-3" aria-label="Page navigation example">
                        <ul class="pagination">
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <li class="page-item"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
                <!--liked pane-->
                <div class="tab-pane fade" id="liked-pane" role="tabpanel" aria-controls="liked-tab">
                    <!--ten posts per page-->
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <span class="h5 mr-3">Post Title</span>
                            <span class="text-muted font-weight-light mr-3">
                                Last Modifed: <span> 2020-10-04 10:12 </span>
                            </span>
                            <span>
                                <a class="mx-1 btn btn-outline-info btn-sm border-0" href="">unlike</a>
                            </span>
                            <div class="mt-1 text-muted font-weight-light">
                                <span> 99 </span> Views |
                                <span> 99 </span> Replies |
                                <span> 99 </span> likes |
                                Created: <span> 2020-10-04 10:12 </span>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <span class="h5 mr-3">Post Title</span>
                            <span class="text-muted font-weight-light mr-3">
                                Last Modifed: <span> 2020-10-04 10:12 </span>
                            </span>
                            <span>
                                <a class="mx-1 btn btn-outline-info btn-sm border-0" href="">unlike</a>
                            </span>
                            <div class="mt-1 text-muted font-weight-light">
                                <span> 99 </span> Views |
                                <span> 99 </span> Replies |
                                <span> 99 </span> likes |
                                Created: <span> 2020-10-04 10:12 </span>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <span class="h5 mr-3">Post Title</span>
                            <span class="text-muted font-weight-light mr-3">
                                Last Modifed: <span> 2020-10-04 10:12 </span>
                            </span>
                            <span>
                                <a class="mx-1 btn btn-outline-info btn-sm border-0" href="">unlike</a>
                            </span>
                            <div class="mt-1 text-muted font-weight-light">
                                <span> 99 </span> Views |
                                <span> 99 </span> Replies |
                                <span> 99 </span> likes |
                                Created: <span> 2020-10-04 10:12 </span>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <span class="h5 mr-3">Post Title</span>
                            <span class="text-muted font-weight-light mr-3">
                                Last Modifed: <span> 2020-10-04 10:12 </span>
                            </span>
                            <span>
                                <a class="mx-1 btn btn-outline-info btn-sm border-0" href="">unlike</a>
                            </span>
                            <div class="mt-1 text-muted font-weight-light">
                                <span> 99 </span> Views |
                                <span> 99 </span> Replies |
                                <span> 99 </span> likes |
                                Created: <span> 2020-10-04 10:12 </span>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <span class="h5 mr-3">Post Title</span>
                            <span class="text-muted font-weight-light mr-3">
                                Last Modifed: <span> 2020-10-04 10:12 </span>
                            </span>
                            <span>
                                <a class="mx-1 btn btn-outline-info btn-sm border-0" href="">unlike</a>
                            </span>
                            <div class="mt-1 text-muted font-weight-light">
                                <span> 99 </span> Views |
                                <span> 99 </span> Replies |
                                <span> 99 </span> likes |
                                Created: <span> 2020-10-04 10:12 </span>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <span class="h5 mr-3">Post Title</span>
                            <span class="text-muted font-weight-light mr-3">
                                Last Modifed: <span> 2020-10-04 10:12 </span>
                            </span>
                            <span>
                                <a class="mx-1 btn btn-outline-info btn-sm border-0" href="">unlike</a>
                            </span>
                            <div class="mt-1 text-muted font-weight-light">
                                <span> 99 </span> Views |
                                <span> 99 </span> Replies |
                                <span> 99 </span> likes |
                                Created: <span> 2020-10-04 10:12 </span>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <span class="h5 mr-3">Post Title</span>
                            <span class="text-muted font-weight-light mr-3">
                                Last Modifed: <span> 2020-10-04 10:12 </span>
                            </span>
                            <span>
                                <a class="mx-1 btn btn-outline-info btn-sm border-0" href="">unlike</a>
                            </span>
                            <div class="mt-1 text-muted font-weight-light">
                                <span> 99 </span> Views |
                                <span> 99 </span> Replies |
                                <span> 99 </span> likes |
                                Created: <span> 2020-10-04 10:12 </span>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <span class="h5 mr-3">Post Title</span>
                            <span class="text-muted font-weight-light mr-3">
                                Last Modifed: <span> 2020-10-04 10:12 </span>
                            </span>
                            <span>
                                <a class="mx-1 btn btn-outline-info btn-sm border-0" href="">unlike</a>
                            </span>
                            <div class="mt-1 text-muted font-weight-light">
                                <span> 99 </span> Views |
                                <span> 99 </span> Replies |
                                <span> 99 </span> likes |
                                Created: <span> 2020-10-04 10:12 </span>
                            </div>
                        </li>
                        <li class="list-group-item">
                            <span class="h5 mr-3">Post Title</span>
                            <span class="text-muted font-weight-light mr-3">
                                Last Modifed: <span> 2020-10-04 10:12 </span>
                            </span>
                            <span>
                                <a class="mx-1 btn btn-outline-info btn-sm border-0" href="">unlike</a>
                            </span>
                            <div class="mt-1 text-muted font-weight-light">
                                <span> 99 </span> Views |
                                <span> 99 </span> Replies |
                                <span> 99 </span> likes |
                                Created: <span> 2020-10-04 10:12 </span>
                            </div>
                        </li>
                    </ul>
                    <!--pagination-->
                    <nav class="mt-3" aria-label="Page navigation example">
                        <ul class="pagination">
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <li class="page-item"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
                <!--        notification pane-->
                <div class="tab-pane fade" id="notification-pane" role="tabpanel" aria-labelledby="notification-tab">
                    <!--ten notifications per page-->
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <span>Replyer's username</span>
                            Replied
                            <a class="card-link">Question title</a>
                            <span class="badge badge-warning">unread</span>
                        </li>

                        <li class="list-group-item">
                            <span>Replyer's username</span>
                            Replied
                            <a class="card-link">Question title</a>
                            <span class="badge badge-warning">unread</span>
                        </li>

                        <li class="list-group-item">
                            <span>Replyer's username</span>
                            Replied
                            <a class="card-link">Question title</a>
                            <span class="badge badge-warning">unread</span>
                        </li>
                        <li class="list-group-item">
                            <span>Replyer's username</span>
                            Replied
                            <a class="card-link">Question title</a>
                            <span class="badge badge-warning">unread</span>
                        </li>

                        <li class="list-group-item">
                            <span>Replyer's username</span>
                            Replied
                            <a class="card-link">Question title</a>
                            <span class="badge badge-warning">unread</span>
                        </li>

                        <li class="list-group-item">
                            <span>Replyer's username</span>
                            Replied
                            <a class="card-link">Question title</a>
                            <span class="badge badge-warning">unread</span>
                        </li>
                        <li class="list-group-item">
                            <span>Replyer's username</span>
                            Replied
                            <a class="card-link">Question title</a>
                            <span class="badge badge-warning">unread</span>
                        </li>

                        <li class="list-group-item">
                            <span>Replyer's username</span>
                            Replied
                            <a class="card-link">Question title</a>
                            <span class="badge badge-warning">unread</span>
                        </li>

                        <li class="list-group-item">
                            <span>Replyer's username</span>
                            Replied
                            <a class="card-link">Question title</a>
                            <span class="badge badge-warning">unread</span>
                        </li>
                        <li class="list-group-item">
                            <span>Replyer's username</span>
                            Replied
                            <a class="card-link">Question title</a>
                            <span class="badge badge-warning">unread</span>
                        </li>
                    </ul>
                    <!--pagination-->
                    <nav class="mt-3" aria-label="Page navigation example">
                        <ul class="pagination">
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <li class="page-item"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
                <!--        personal info pane-->
                <div class="tab-pane fade p-2" id="personal-info-pane" role="tabpanel"
                     aria-labelledby="personal-info-tab">
                    <!-- th:object 不能使用 th:object="${session.user}"-->
                    <form class="personal-info p-5 m-auto" method="post" onsubmit="return isValidated()"
                          th:action="@{/authentication/update}" th:object="${user}">
                        <div class="row mb-3">
                            <img class="mx-auto rounded justify-content-center" th:src="*{avatarUrl}"
                                 src="https://picsum.photos/100/100" alt="" width="100" height="100">
                        </div>
                        <h4 class="h5 mb-3 font-weight-normal text-center"><span th:text="*{username}">User Name</span>'s
                            Personal Information</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="firstName">First name</label>
                                <input th:field="*{firstname}" type="text" class="form-control" id="firstName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName">Last name</label>
                                <input th:field="*{lastname}" type="text" class="form-control" id="lastName" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="username">Username</label>
                            <input th:field="*{username}" type="text" class="form-control" id="username" required>
                        </div>

                        <div class="mb-3">
                            <label for="email">Email</label>
                            <input th:field="*{emailAddress}" type="email" class="form-control" id="email" required
                                   readonly>
                        </div>

                        <div class="mb-3">
                            <label for="password">Password</label>
                            <input th:field="*{password}" type="password" class="form-control" id="password"
                                   th:value="*{password}">
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <button class="btn btn-info" type="button" th:data-email-address="*{emailAddress}"
                                        onclick="getValidationCode(this.dataset.emailAddress)">Get Validation Code
                                </button>
                            </div>

                            <div class="col-md-6 mb-3">
                                <div class="input-group">
                                    <div class="input-group-prepend">
                            <span id="validation-mark" class="input-group-text" hidden>
                                <i class="fas fa-check" style="color: #1DC116"></i>
                            </span>
                                    </div>
                                    <input onkeyup="checkValidationCode(this.value)" type="text" class="form-control"
                                           id="validation-code">
                                </div>
                            </div>
                        </div>
                        <hr class="mb-3">
                        <button class="btn btn-success btn-block" type="submit">Update</button>
                    </form>
                </div>
            </div>
        </div>
    </div>


</main>
<footer th:replace="fragments/footer-fragment :: footer">
    Index Footer Part
</footer>
<!--/*/ <th:block th:replace="fragments/head-fragment :: js"> /*/-->
<script type="application/javascript" src="../static/jQuery/jquery-3.5.1.min.js"></script>
<script type="application/javascript" src="../static/bootstrap-4.5.2-dist/js/bootstrap.min.js"></script>
<!--/*/ </th:block> /*/-->
<!--function that controls which pane would be active on load-->
<script type="application/javascript" src="../static/js/profile.js"></script>
<script th:inline="javascript">
    let param = /*[[${tab}]]*/ "post";
    let validationCode = "";

    window.onload = () => {
        const tabName = param + '-tab';
        const paneName = param + '-pane';

        const questionTab = document.getElementById(tabName);
        questionTab.classList.add("active");
        questionTab.setAttribute("aria-selected", "true");

        const questionPane = document.getElementById(paneName);
        questionPane.classList.add("active");
        questionPane.classList.add("show");
    }

    function getValidationCode(emailAddress) {
        alert("We sent the validation code to: " + emailAddress);

        fetch("/authentication/validation-code", {
            method: "get",
        })
            .catch(errorMessage => alert("Can't get validation code due to: " + errorMessage));
    }


    function checkValidationCode(inputValidationCode) {
        /*debug*/
        console.log(inputValidationCode);
        const validationMarkEle = document.getElementById("validation-mark");

        fetch("/authentication/validation-code", {
            method: "post",
            headers: {
                "Content-type": "application/json"
            },
            body: JSON.stringify({ // 传入json的时候要序列化, 对应服务端是ValidationInput class
                "validationCode": "" + inputValidationCode, // 保持与服务端数据类型一致
            })
        })
            .then(response => response.json())
            .then(data => {
                /*debug*/
                console.log(data);
                // hide the element when result !=== 'true'
                validationMarkEle.hidden = data.result !== "true";
            })
            .catch(errorMessage => alert("Something wrong due to: " + errorMessage));
    }

    function isValidated() {
        const validationMarkEle = document.getElementById("validation-mark");
        if (validationMarkEle.hidden === true) {
            alert("Your need to enter the correct validation code!")
            return false;
        }
        return true;
    }
</script>
</body>
</html>